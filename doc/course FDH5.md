
<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} -->

<!-- code_chunk_output -->

- [故障诊断H5 模板](#故障诊断h5-模板)
  - [配置表说明](#配置表说明)
    - [menuInfo.xml](#menuinfoxml)
    - [actionStep.xml](#actionstepxml)
    - [oQTest.json](#oqtestjson)
    - [tutorial.json](#tutorialjson)
  - [动画说明](#动画说明)
    - [动画里代码](#动画里代码)
      - [设置菜单栏里导航按钮的状态-通用](#设置菜单栏里导航按钮的状态-通用)
      - [设置具体动画里操作配置](#设置具体动画里操作配置)
        - [普通拆卸动画 D1](#普通拆卸动画-d1)
        - [普通安装动画 S15](#普通安装动画-s15)
        - [万用表检测动画 D7](#万用表检测动画-d7)
        - [蓄电池检测动画 D20](#蓄电池检测动画-d20)
        - [诊断仪操作动画 DStepNext](#诊断仪操作动画-dstepnext)
  - [外部素材替换说明](#外部素材替换说明)
    - [操作说明PDF](#操作说明pdf)
    - [参考资料PDF](#参考资料pdf)
    - [index.fla外部图片](#indexfla外部图片)
    - [操作动画](#操作动画)
    - [演练模式的视频](#演练模式的视频)
    - [训练模式的页面poster](#训练模式的页面poster)
    - [考核模式的页面poster](#考核模式的页面poster)
    - [所有的外部代码](#所有的外部代码)
  - [版本更新日志](#版本更新日志)
    - [虚拟实训 - 故障诊断 H5](#虚拟实训-故障诊断-h5)
        - [版本：200225](#版本200225)
        - [版本：200220](#版本200220)
        - [版本：200213](#版本200213)
        - [版本：200211](#版本200211)
        - [版本：200203](#版本200203)

<!-- /code_chunk_output -->


# 故障诊断H5 模板

------

## 配置表说明
### menuInfo.xml 

> 菜单配置表  

![](https://images.gitee.com/uploads/images/2020/0227/182846_7fc4df4b_1537375.jpeg)

> root 节点 （根节点）

| 属性 | 描述               | 参考值   | 值类型 | 备注 |
| ---- | ------------------ | -------- | ------ | ---- |
| name | 当前故障诊断的名字 | xxx-虚拟 | String |      |

> root → mItem 节点 （1级关键步骤菜单节点，每一个1级关键步骤菜单都对应一个mItem）

| 属性 | 描述       | 参考值   | 值类型 | 备注 |
| ---- | ---------- | -------- | ------ | ---- |
| mId  | 菜单的序号 | mItem_1  | String |      |
| name | 菜单的名字 | 菜单名字 | String |      |

> root → mItem → page 节点 （每一个page代表一个动画页面；每个菜单下有几个页面，就填几个page）

| 属性    | 描述                                   | 参考值                 | 值类型 | 备注             |
| ------- | -------------------------------------- | ---------------------- | ------ | ---------------- |
| id      | 动画页面的序号                         | 1                      | String |                  |
| name    | 动画页面的名字                         |                        | String | 可以空着         |
| href    | 动画页面的相对浏览路径                 | static/page/D1/D1.html | String |                  |
| poster  | 训练模式下，动画页面的加载状态显示图片 | static/poster/D1.jpg   | String | 图片大小尽量压缩 |
| poster2 | 考核模式下，动画页面的加载状态显示图片 | static/poster2/D1.jpg  | String | 同上             |



### actionStep.xml

> 操作步骤配置表  

![](https://images.gitee.com/uploads/images/2020/0227/182836_94c672f0_1537375.jpeg)

> root → item 节点 （每一个item代表一个动画里的操作步骤；有几个操作步骤，填几个item）

| 属性     | 描述                 | 参考值      | 值类型 | 备注             |
| -------- | -------------------- | ----------- | ------ | ---------------- |
| id       | 操作步骤的序号       | 1           | String |                  |
| progress | 本次操作给予的进度值 |             | String | 保留字段，先空着 |
| score    | 本次操作给予的分值   | 1           | String |                  |
| name     | 操作步骤的内容       | 点击查看XXX | String |                  |



### oQTest.json

> 维修工单测试题配置表

![](https://images.gitee.com/uploads/images/2020/0227/182856_e2e655ef_1537375.jpeg)

> root → page 节点 （每一个page代表一个测试子页面；page8代表有8个测试子页面）
>
> root → page 节点下数据
>
> ```json
>  {"topic":"radioBox_1", "answer":"selectBox_1", "score":"1"}
> ```
>
> 有几道题目，就填几行数据；
>
> **注意：每个最后一行数据结尾不要逗号，**

| 属性   | 描述                            | 参考值      | 值类型 | 备注                                                  |
| ------ | ------------------------------- | ----------- | ------ | ----------------------------------------------------- |
| topic  | 当前页面An动画里-题目的实例名   | radioBox_1  | String | radioBox代表单选题；checkBox代表多选题；              |
| answer | 当前题目-对应的正确选项的实例名 | selectBox_1 | String | 如有多个答案，可以按照此规则填selectBox_1,selectBox_3 |
| score  | 当前题目给予的分值              | 1           | String |                                                       |



### tutorial.json

> 演练模块视频配置表

![](https://images.gitee.com/uploads/images/2020/0227/182903_92b9ab07_1537375.jpeg)

> root → faultName 节点 （这个节点现在是保留节点，可以空着）
>
> root → item 节点下数据
>
> ```json
>       {
>         "id": 1,
>         "name": "",
>         "video": "static/video/trailer_hd1.mp4",
>         "poster": "",
>         "text": ""
>       },
> ```
>
> 有几个视频，就填几行数据；
>
> **注意：每个最后一行数据结尾不要逗号，**

| 属性   | 描述         | 参考值                       | 值类型 | 备注             |
| ------ | ------------ | ---------------------------- | ------ | ---------------- |
| id     | 视频的序号   | 1                            | String |                  |
| name   | 视频的名字   |                              | String | 可以空着         |
| video  | 视频的路径   | static/video/trailer_hd1.mp4 | String |                  |
| poster | 视频的预览图 |                              | String | 保留字段，先空着 |
| text   | 视频的文字   |                              | String | 保留字段，先空着 |



***

## 动画说明

###  动画里代码

#### 设置菜单栏里导航按钮的状态-通用

> 包括 拆卸动画，安装动画，万用表检测动画，蓄电池检测动画，诊断仪操作动画

```javascript
setMItemState({mItemId:"1", state:"3"});
```

| 属性    | 描述                | 参考值 | 值类型 | 备注                      |
| ------- | ------------------- | ------ | ------ | ------------------------- |
| mItemId | 菜单的序号-数字部分 | 1      | String | 和menuInfo.xml里的mId对应 |
| state   | 菜单的状态值        | 3      | String | 目前固定为3               |



#### 设置具体动画里操作配置

##### 普通拆卸动画 D1

![image](https://user-images.githubusercontent.com/5111701/59334597-6d66a900-8d2d-11e9-962a-1c7c2a2817fe.png)
![image](https://user-images.githubusercontent.com/5111701/59334660-938c4900-8d2d-11e9-9b59-13dd58c753bb.png)



| 属性    | 描述                                                         | 参考值    | 值类型 | 备注                           |
| ------- | ------------------------------------------------------------ | --------- | ------ | ------------------------------ |
| btn     | 热点区域按钮的实例名。                                       | hotBtn_1  | String |                                |
| mc      | 动画里零件MC的实例名，如果无，则空着。                       | part_1    | String |                                |
| partId  | 点击当前热点后，需要在零件面板里出现或者拿出的零件的id；如果无，则空着。 |           | String | 保留字段，先空着               |
| toolId  | 触发当前热点，需要的工具的id；如果无，则空着。               |           | String | 保留字段，先空着               |
| toolAni | 使用工具触发当前热点后，播放的动画MC的实例名；如果无，则空着。 | toolAni_1 | String |                                |
| stepId  | 当前操作步骤的步骤序号。                                     | 1         | String | 和actionStep.xml里item的id对应 |

##### 普通安装动画 S15

> 可以参考拆卸动画

##### 万用表检测动画 D7

![](https://images.gitee.com/uploads/images/2020/0228/105447_1bc9fc26_1537375.jpeg)
![image](https://images.gitee.com/uploads/images/2020/0228/105502_b6373bd1_1537375.jpeg)

> 这是使用万用表红黑表笔和检测点相交，产生的数据；一组数据就是一行；
>
> **注意：**
>
> 1. 动画里检测点实例名必须加 port_ 前缀；
> 2. 动画里检测笔（redPen和blackPen）的中心点位置必须正确，这是表笔触碰到检测点，并点击放置后的显示状态图；

| 属性    | 描述                       | 参考值   | 值类型 | 备注                           |
| ------- | -------------------------- | -------- | ------ | ------------------------------ |
| rPortId | 红表笔触碰的检测点的实例名 | port_M_Z | String |                                |
| bPortId | 黑表笔触碰的检测点的实例名 | port_M_F | String |                                |
| voValue | 产生的电压值               | 12       | String | 如果空着，会显示默认值0        |
| reValue | 产生的电阻值               | OL       | String | 如果空着，会显示默认值0        |
| soundId | 产生的声音的元件实例名     |          | String | 保留字段，目前都空着           |
| isFault | 是否是故障状态             | false    | String | 保留字段，目前都填false        |
| stepId  | 当前操作步骤的步骤序号     | 15       | String | 和actionStep.xml里item的id对应 |



##### 蓄电池检测动画 D20

![](https://images.gitee.com/uploads/images/2020/0228/105513_dacedeeb_1537375.jpeg)
![](https://images.gitee.com/uploads/images/2020/0228/105520_0b0f15c4_1537375.jpeg)

> 这是使用蓄电池红黑表笔和检测点相交，产生的数据；一组数据就是一行；
>
> **注意：**
>
> 1. 动画里检测点实例名必须加 port_ 前缀；
> 2. 动画里检测笔（redPen和blackPen）的中心点位置必须正确，这是表笔触碰到检测点，并点击放置后的显示状态图；

| 属性    | 描述                       | 参考值         | 值类型 | 备注                           |
| ------- | -------------------------- | -------------- | ------ | ------------------------------ |
| rPortId | 红表笔触碰的检测点的实例名 | port_Z_1       | String |                                |
| bPortId | 黑表笔触碰的检测点的实例名 | port_Z_5       | String |                                |
| voValue | 产生的电压值               |                | String | 保留字段，目前都空着           |
| reValue | 产生的电阻值               |                | String | 保留字段，目前都空着           |
| soundId | 产生的声音的元件的实例名   | sound_fuelPump | String |                                |
| isFault | 是否是故障状态             | false          | String | 保留字段，目前都填false        |
| stepId  | 当前操作步骤的步骤序号     | 51             | String | 和actionStep.xml里item的id对应 |



##### 诊断仪操作动画 DStepNext

> 简单的按钮动画，看具体模板就懂了。

------

## 外部素材替换说明

##### 操作说明PDF

​       方法：把新的PDF命名改为 ODoc ，然后放到 static\pdf 目录下，进行替换。

##### 参考资料PDF

​       方法：把新的PDF命名改为 RDoc，然后放到 static\pdf 目录下，进行替换。

##### index.fla外部图片

> 包括 菜单栏的底图，按钮图；左侧工具栏的底图，按钮图 等，都可以在 static\img\com 目录下找到

​        方法：找到对应的图片，复制其命名，给新图片命名，然后拷贝到  static\img\com 目录下，进行替换。

##### 操作动画

​        方法：包括 拆卸动画，安装动画，万用表检测动画，蓄电池检测动画，诊断仪操作动画 ，这些都放在 static\page 目录下。

##### 演练模式的视频

​         方法：都放在 static\video 目录下。

##### 训练模式的页面poster

​         方法：都放在 static\poster 目录下。

##### 考核模式的页面poster

​         方法：都放在 static\poster2 目录下。

##### 所有的外部代码

​         方法：都放在 static\js 目录下。



------



## 版本更新日志

### 虚拟实训 - 故障诊断 H5

外链： http://bmw.jingge.com/skoda/fdh5/

##### 版本：200225

内容：  
1.制作 蓄电池鼠标cur，更改蓄电池模板以及相关代码；  
2.添加 当前分数控制台输出，做一步输出一次，要是有异常，可以立马知道；  
3.解决 得分统计显示输出异常问题；  
4.添加 训练模式-完成页面出现后，禁止其他模块触发交互功能，只能回到主页；  
5.添加 一些ie上代码兼容；         

------

##### 版本：200220

内容：
1.修改 菜单目录-状态显示 相关代码；  
2.修改 演练模块 视频信息配置方式(js代码，改成json表);  
3.修改 维修工单模块 答案，分数信息配置方式(js代码，改成json表);  
4.修改 加载，解析xml的方法；  
5.制作 蓄电池鼠标cur，更改蓄电池检测模板以及相关代码；  
6.根据 修改意见，修改一些ui显示，细节功能；  
7.添加 一些方法的ie兼容；  

------

##### 版本：200213

内容：  
1.添加 故障设置模块（tab切换页面；subPage里选项可以选择1-2个，不能超过2个；有随机抽取1-2个选项的功能；返回主页功能）；  
2.更改 操作面板显示顺序，以及相关功能；  
3.修改 训练模块-重置模块的小bug；  

------

##### 版本：200211

内容：  
1.添加 维修工单模板（根据tabBtn切换子页试卷；每个试卷里可以设置单选和多选题题型，题型可以同时存在，也可以单独存在；可以配置正确答案和每道题的分数；点击完成按钮后，会进行批卷计算，获得得分，在训练和考核模块的结束页面显示具体得分；）    
2.修改 分数设定（目前是 总分=步骤分+维修工单分；每个步骤分和每道题目分都可以通过配置单独设置；目前分数只会在考核模式下上传到学习平台；）  
3.修改 一些小bug；  

------

##### 版本：200203

内容：  
1.添加 步骤导航目录功能（点击调整到对应步骤第一个小动画）；  
2.把 步骤导航目录从步骤动画里提取到主页上，年后动画人员需要把page下动画里相关步骤导航目录全删掉，需要设置菜单栏里导航按钮的状态的话，通过添加代码`setMItemState({mItemId:"1", state:"3"}); `，到时候具体讲解怎么用；  
3.修改 演练模块-切换视频模块的上一个，下一个按钮功能；  
4.解决page下步骤动画之间切换时闪白屏，过渡的问题；通过在menuInfo.xml里添加poster字段，来解决；（实现逻辑：切换下一个步骤动画时，先加载一张下一个动画初始图片poster，然后再加载下一个动画的所有素材，等下一个动画素材都加载完，并且渲染好之后，再把poster隐藏，显示下一个动画，解决切换页面之间的闪烁问题）    

------

